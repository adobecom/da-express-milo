# Spectrum 2 Import and Consumption (Filters / Picker)

How Spectrum Web Components v2 is loaded and used by the color-explore **filters** (picker dropdowns).

---

## Summary

- **What:** SWC (`sp-theme`, `sp-picker`, `sp-menu`, `sp-menu-item`, `sp-popover`, `sp-overlay`) for filter dropdowns in **color-explore** (Strips + Gradients).
- **Where:** Bundles in `express/code/scripts/widgets/spectrum/dist/`. Override CSS: `spectrum-picker-override.css` (injected on first filter create).
- **When:** Loaded on demand when `createFiltersComponent()` runs (from strips or gradients renderer), not at page load.

---

## Bundle prerequisite

Files in `dist/` are **generated** (header: `Generated by da-express-milo Spectrum Web Components bundler`). If `dist/` is committed, no build is needed. To add/change components or recreate `dist/`, run the bundler (script not in this repo; may be on Picker branch or in team docs).

---

## Load order (`createFiltersComponent.js`)

1. **Guard:** If `sp-theme`, `sp-picker`, `sp-menu`, `sp-menu-item` already registered → skip load.
2. **Spectrum (once):** `loadSpectrumComponents()` imports in order: `lit.js` → `base.js` → `theme.js` → `reactive-controllers.js` → `shared.js` → `icons-ui.js` + `icons-workflow.js` → `overlay.js` + `popover.js` → `menu.js` → `picker.js`.
3. **Override CSS (once):** `loadPickerOverrideStyles()` injects `<link>` to `spectrum-picker-override.css`.
4. **Per filter:** `createFilterPicker(filter)` builds `sp-theme` → `sp-picker` → `sp-menu-item`s, listens to `change` → `onFilterChange(filterValues)`, appends `sp-theme` to `.filters-container`.

DOM: `.filters-container` contains multiple `sp-theme` (each with one `sp-picker` and its `sp-menu-item` children). Override and layout are scoped under `.color-explore`.

---

## Data flow

Filter config (`id`, `label`, `options`) from `getDefaultFilters()` (strips vs gradients). Picker `change` → `filterValues[id]` updated → `onFilterChange(filterValues)` → renderer can refetch/filter and call `renderer.update(...)`.

---

## References

- **Component:** `createFiltersComponent.js`
- **Dist:** `widgets/spectrum/dist/*.js`
- **Override:** `spectrum-picker-override.css`
- **Block layout:** `blocks/color-explore/color-explore.css`
- **Consumers:** `createStripsRenderer.js`, `createGradientsRenderer.js`
